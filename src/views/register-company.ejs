<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
        <title>Register Form</title>
        <!-- Bootstrap CSS -->
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
    </head>

    <body>
        <%- include('partials/header') %>
        <br />
        <br />
        <br />

        <form class="bg-light p-4 rounded" style="max-width: 600px; margin: auto" onsubmit="handleRegister(event)">
            <h4 class="mb-3">Đăng ký tài khoản nhà tuyển dụng</h4>
            <p>Điền thông tin sau để nhận tư vấn trực tiếp từ TopDev</p>
            <div class="mb-3">
                <label for="companyName" class="form-label">Tên công ty</label>
                <input type="text" class="form-control" id="companyName" placeholder="Ví dụ: TopDev" required />
            </div>
            <div class="row">
                <div class="col-md-6 mb-3">
                    <label for="fullName" class="form-label">Họ và Tên</label>
                    <input type="text" class="form-control" id="fullName" placeholder="Ví dụ: Nguyễn Văn A" required />
                </div>
                <div class="col-md-6 mb-3">
                    <label for="currentPosition" class="form-label">Vị trí hiện tại</label>
                    <input
                        type="text"
                        class="form-control"
                        id="currentPosition"
                        placeholder="Ví dụ: HR Specialist"
                        required
                    />
                </div>
            </div>
            <div class="row">
                <div class="col-md-6 mb-3">
                    <label for="email" class="form-label" required>Email</label>
                    <input type="email" class="form-control" id="email" placeholder="Ví dụ: hr@topdev.vn" required />
                </div>
                <div class="col-md-6 mb-3">
                    <label for="phoneNumber" class="form-label">Số điện thoại</label>
                    <input type="tel" class="form-control" id="phoneNumber" placeholder="Ví dụ: 0912345678" required />
                </div>
            </div>
            <div class="form-check mb-3">
                <input class="form-check-input" type="checkbox" id="agreePrivacy" required />
                <label class="form-check-label" for="agreePrivacy">
                    Team16 tôn trọng và bảo vệ dữ liệu cá nhân của bạn. Bằng việc điền thông tin và nhấn đăng ký, bạn đã
                    đồng ý với
                    <a href="#" class="link-info">Điều khoản sử dụng và Chính sách bảo mật</a>
                    của TopDev
                </label>
            </div>
            <button type="submit" id="consultationForm" class="btn btn-primary">Gửi thông tin</button>
        </form>
        <br />
        <br />
        <br />
        <%- include('partials/footer') %>
        <!-- SweetAlert2 JS -->
        <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.4.19/dist/sweetalert2.min.js"></script>
        <!-- Bootstrap JS and dependencies -->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
        <script>
            function handleRegister(event) {
                event.preventDefault();

                Swal.fire({
                    title: "Đang thực hiện...",
                    html: "Vui lòng đợi trong giây lát...",
                    allowOutsideClick: false,
                    didOpen: () => {
                        Swal.showLoading(); // Hiển thị vòng quay loading
                    },
                });

                const companyName = document.getElementById("companyName").value;
                const fullName = document.getElementById("fullName").value;
                const currentPosition = document.getElementById("currentPosition").value;
                const email = document.getElementById("email").value;
                const phoneNumber = document.getElementById("phoneNumber").value;
                const agreePrivacy = document.getElementById("agreePrivacy").checked;

                if (!agreePrivacy) {
                    Swal.fire({
                        icon: "error",
                        title: "Lỗi",
                        text: "Vui lòng đồng ý với Điều khoản sử dụng và Chính sách bảo mật của TopDev!",
                        showConfirmButton: true,
                    });
                    return;
                }

                const requestData = {
                    companyName,
                    fullName,
                    currentPosition,
                    email,
                    phoneNumber,
                };

                fetch("/company/register", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                    },
                    body: JSON.stringify(requestData),
                })
                    .then((response) => response.json())
                    .then((data) => {
                        if (data.success) {
                            Swal.fire({
                                icon: "success",
                                title: "Gửi thành công!",
                                text: "Thông tin của bạn đã được gửi thành công!",
                                showConfirmButton: false,
                                timer: 1500,
                            }).then(() => {
                                window.location.href = "/"; // Điều hướng đến trang chính sau 1.5s
                            });
                        } else {
                            Swal.fire({
                                icon: "error",
                                title: "Lỗi",
                                text: "Gửi thông tin thất bại. Vui lòng thử lại!",
                                showConfirmButton: true,
                                timer: 1500,
                            });
                        }
                    })
                    .catch((error) => {
                        Swal.fire({
                            icon: "error",
                            title: "Lỗi",
                            text: "Đã có lỗi xảy ra. Vui lòng thử lại!",
                            showConfirmButton: true,
                            timer: 1500,
                        });
                    });
            }
            document.addEventListener("keydown", function (e) {
                if (e.key === "Enter") {
                    e.preventDefault();
                    handleRegister(e);
                }
            });
        </script>
    </body>
</html>
